<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Offers</title>
  <style>
    .offer-slider-container {
      position: relative;
      top: 10px;
      height: 12.5vh;
      overflow: hidden;
      border-radius: 15px;
      background: #2c3e50;
    }
    .offer-slider {
      display: flex;
      height: 100%;
      transition: transform 0.2s ease-in-out;
    }
    .offer-slide {
      min-width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      cursor: pointer;
      opacity: 0.95;
    }
    .offer-slide:hover { opacity: 1; }
    .offer-nav {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 6px;
    }
    .offer-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255,255,255,0.5);
      cursor: pointer;
      transition: 0.3s;
    }
    .offer-dot.active {
      background: #fff;
      transform: scale(1.3);
    }
    .offer-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.2);
      color: white;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      font-size: 0.8rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .offer-btn:hover { background: rgba(255,255,255,0.4); }
  </style>
</head>
<body>

<section class="offer-section">
  <div class="offer-slider-container">
    <div class="offer-slider" id="offerSlider"></div>
    <button class="offer-btn prev">&#10094;</button>
    <button class="offer-btn next">&#10095;</button>
    <div class="offer-nav" id="offerNav"></div>
  </div>
</section>

<!-- âœ… Firebase compat SDKs (load safely from anywhere) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCPbOZwAZEMiC1LSDSgnSEPmSxQ7-pR2oQ",
    authDomain: "mirdhuna-25542.firebaseapp.com",
    databaseURL: "https://mirdhuna-25542-default-rtdb.firebaseio.com",
    projectId: "mirdhuna-25542",
    storageBucket: "mirdhuna-25542.appspot.com",
    messagingSenderId: "575924409876",
    appId: "1:575924409876:web:6ba1ed88ce941d9c83b901"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const slider = document.getElementById("offerSlider");
  const nav = document.getElementById("offerNav");
  let slides = [];
  let index = 0;
  let autoSlideInterval;

  // ðŸ”¥ Read from 'offerslide'
  firebase.database().ref('offerslide').on('value', snapshot => {
    const data = snapshot.val();

    if (autoSlideInterval) clearInterval(autoSlideInterval);
    slider.innerHTML = '';
    nav.innerHTML = '';
    slides = [];

    if (!data) return;

    Object.values(data).forEach(item => {
      if (!item.image) return;

      const div = document.createElement('div');
      div.classList.add('offer-slide');
      div.dataset.url = item.url || '';
      div.dataset.image = item.image;
      div.style.backgroundImage = `url('${item.image}')`;

      slider.appendChild(div);
      slides.push(div);
    });

    if (slides.length > 0) setupOfferSlider();
  });

  function setupOfferSlider() {
    const dots = [];
    nav.innerHTML = '';

    slides.forEach((slide, i) => {
      const dot = document.createElement('div');
      dot.classList.add('offer-dot');
      if (i === 0) dot.classList.add('active');
      dot.addEventListener('click', () => goToSlide(i));
      nav.appendChild(dot);
      dots.push(dot);

      slide.addEventListener('click', () => {
        const imgUrl = slide.dataset.image;
        const url = slide.dataset.url;

        firebase.database().ref('slideClicks').push({
          image: imgUrl,
          url: url,
          clickedAt: new Date().toISOString()
        });

        if (url) window.open(url, '_blank');
      });
    });

    function goToSlide(i) {
      index = i;
      slider.style.transform = `translateX(-${i * 100}%)`;
      dots.forEach((d, j) => d.classList.toggle('active', i === j));
    }

    document.querySelector(".prev").onclick = () =>
      goToSlide((index - 1 + slides.length) % slides.length);
    document.querySelector(".next").onclick = () =>
      goToSlide((index + 1) % slides.length);

    autoSlideInterval = setInterval(() => {
      goToSlide((index + 1) % slides.length);
    }, 2500);
  }
</script>

</body>
</html>
